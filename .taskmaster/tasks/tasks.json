{
  "master": {
    "tasks": [
      {
        "id": 26,
        "title": "Implement Pre-compaction Memory Flush Hook",
        "description": "Enhance existing PreCompact hook to trigger Hindsight retain() before context compression (F3.1, Phase 1 quick win)",
        "details": "Modify claude-harness-setup PreCompact hook: 1) Check session state for prior flush this cycle 2) Extract active goals, in-progress decisions, unresolved questions, key findings 3) Call Hindsight retain() to both banks with NO_REPLY pattern if nothing to save 4) Log flush completion. Use existing Hindsight HTTP API at localhost:8888.",
        "testStrategy": "Unit test hook trigger on simulated compaction; Integration test with Hindsight recall post-compaction verifies 90%+ context preservation; Measure flush time < 10s (AC-3.1)",
        "priority": "high",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 27,
        "title": "Create USER.md Operator Profile File",
        "description": "Generate structured USER.md with work hours, preferences, loaded at session start (F5.2, Phase 1 quick win)",
        "details": "Create .claude/USER.md template: work_hours: '8AM-10PM', comm_prefs: {}, tool_prefs: {}. Add SessionStart hook to read/parse USER.md and inject into system prompt. Auto-populate from Hindsight user-preferences context.",
        "testStrategy": "Verify USER.md loads in new session prompt; Test preference application (e.g., 'morning briefings'); Validate parsing edge cases (AC-5.2)",
        "priority": "high",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 28,
        "title": "Implement Session Health Monitoring",
        "description": "Real-time context window tracking with 80% threshold pre-compaction trigger (F5.3, Phase 1 quick win)",
        "details": "Enhance statusline analyzer: 1) Track context_tokens/current_window via API 2) Alert at 80% threshold → trigger PreCompact flush 3) Track token_spend/session_duration 4) Stale context detection (>24h old history). Configurable thresholds in .claude/config.json.",
        "testStrategy": "Simulate context growth to 80%; Verify auto-flush triggers; Test token alerts at configured limits (AC-5.3)",
        "priority": "high",
        "dependencies": [
          26
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 29,
        "title": "Add Orchestrator Failure Classification",
        "description": "Classify failures into auth/resource/logic/scope/external categories (F4.1, Phase 1 quick win)",
        "details": "Extend orchestrator monitoring: Parse error messages/return codes → classify into 5 categories → store classification in beads metadata JSON. Categories: auth (API errors), resource (OOM/rate limit), logic (infinite loops), scope (budget exceeded), external (service down).",
        "testStrategy": "Unit tests for each failure category classification; Integration test stores classification in bead metadata; Verify 30s classification time (AC-4.1)",
        "priority": "high",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 30,
        "title": "Spawn S3-Communicator Teammate Core",
        "description": "Create Haiku communicator teammate in s3-live team with background execution (F1.1, Phase 2 core)",
        "details": "In System 3 Operator session: TeamCreate('s3-live'); Task(subagent_type='general-purpose', model='haiku', run_in_background=True, team_name='s3-live', name='s3-communicator', prompt='.claude/skills/system3-orchestrator/communicator/'). Inherits all MCP tools from parent.",
        "testStrategy": "Verify teammate spawns in ~/.claude/teams/s3-live/; Test inherits Hindsight/beads MCP tools; Confirm background execution doesn't block parent (AC-1.1)",
        "priority": "high",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 31,
        "title": "Implement Communicator Heartbeat Loop",
        "description": "10-minute sleep → check → sleep cycle with configurable active hours",
        "details": "In communicator skill: while True: if active_hours(): read HEARTBEAT.md → execute checks → sleep(600). Active hours default 8AM-10PM user local time from USER.md. Early return 'HEARTBEAT_OK' if no action.",
        "testStrategy": "Test 10-min cycle timing; Verify active hours respect; Confirm HEARTBEAT_OK silent return (AC-1.1, AC-1.2)",
        "priority": "high",
        "dependencies": [
          30
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 32,
        "title": "Create HEARTBEAT.md Configuration File",
        "description": "Define heartbeat check instructions: beads, tmux, git, Hindsight goals (F1.2)",
        "details": "Generate .claude/HEARTBEAT.md: beads_status: 'bd ready, bd list --status=in_progress'; orchestrator_health: 'tmux ls'; git_status: 'git status'; hindsight_goals: 'recall private bank'. Communicator reads on each cycle.",
        "testStrategy": "Verify communicator reads empty file → early return; Test parses all check types correctly (AC-1.2)",
        "priority": "medium",
        "dependencies": [
          30,
          31
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 33,
        "title": "Implement Google Chat MCP Server",
        "description": "Stdio MCP server with Google Chat API integration (F2.1, Phase 2 core)",
        "details": "Create google-chat-bridge MCP server: tools=['send_message', 'get_new_messages', 'mark_read', 'send_task_completion', 'get_stats']. Configure via .mcp.json with service account credentials. Use Google Chat API v2 (webhook + REST).",
        "testStrategy": "Start MCP server → verify tools register in .mcp.json; Test send_message to configured space (AC-2.1)",
        "priority": "high",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 34,
        "title": "Add Heartbeat Beads Status Check",
        "description": "Check bd ready, bd list --status=in_progress in heartbeat cycle",
        "details": "Communicator executes: bd ready → parse P0-P1 beads; bd list --status=in_progress → check stuck beads (>2h). If actionable → prepare WORK_FOUND context brief.",
        "testStrategy": "Create test P0 bead → verify detection in heartbeat; Test in_progress bead aging detection (AC-1.3)",
        "priority": "medium",
        "dependencies": [
          31,
          32
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 35,
        "title": "Add Heartbeat Tmux/Orchestrator Health Check",
        "description": "Monitor tmux session status in heartbeat cycle",
        "details": "tmux ls → parse System 3 Operator session status. If crashed/stopped → classify failure → SendMessage to team-lead: 'ORCHESTRATOR_DOWN: [details]'.",
        "testStrategy": "Kill tmux session → verify detection and wake message (AC-1.3)",
        "priority": "medium",
        "dependencies": [
          31,
          32
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 36,
        "title": "Implement Google Chat Outbound Message Formatting",
        "description": "Structured cards, markdown rendering, 4096 char chunking (F2.3, Phase 2 core)",
        "details": "MCP send_message tool: Convert markdown → Google Chat format; Chunk >4096 chars; Support cards with action buttons; Media: screenshots, code blocks. Thread by conversation_id.",
        "testStrategy": "Test long message chunking; Verify card rendering; Test media attachment (AC-2.2)",
        "priority": "high",
        "dependencies": [
          33
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 37,
        "title": "Add Heartbeat Git Status Check",
        "description": "Check uncommitted changes, pending PR reviews",
        "details": "git status → parse uncommitted changes; gh pr list --status=open → count pending reviews. Actionable if >5 files changed or P0 PRs pending.",
        "testStrategy": "Create uncommitted files → verify detection; Test PR list parsing (AC-1.3)",
        "priority": "medium",
        "dependencies": [
          31,
          32
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 38,
        "title": "Implement Cost-Optimized Model Routing",
        "description": "Haiku→Sonnet→Opus escalation with token tracking (F1.3)",
        "details": "Communicator default: haiku. Actionable work → SendMessage to sonnet-planner teammate. Strategic → escalate to opus operator. Track tokens/cycle in ~/.claude/heartbeat_costs.json. HEARTBEAT_OK <5000 tokens.",
        "testStrategy": "Verify Haiku default; Test escalation paths; Confirm <5000 token non-actionable cycles (AC-1.5)",
        "priority": "medium",
        "dependencies": [
          30,
          31
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 39,
        "title": "Create Communicator Skill Definition",
        "description": "Define .claude/skills/system3-orchestrator/communicator/SKILL.md",
        "details": "Skill prompt: 'You are S3-Communicator. Heartbeat loop: read HEARTBEAT.md → check → SendMessage if actionable. User intermediary for ASK_USER questions. Cost-conscious: early HEARTBEAT_OK returns.'",
        "testStrategy": "Load skill in test teammate → verify behavior matches spec (AC-1.1)",
        "priority": "medium",
        "dependencies": [
          30
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 40,
        "title": "Implement Google Chat Inbound Message Routing",
        "description": "Webhook receives messages → route to System 3 or queue (F2.2)",
        "details": "Google Chat webhook → parse {sender, text, timestamp, thread_id} → rate limit → if System3 running: SendMessage(recipient='team-lead'); else: queue for heartbeat.",
        "testStrategy": "Send test webhook → verify routing to running session; Test queueing when idle (AC-2.3)",
        "priority": "high",
        "dependencies": [
          33
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 41,
        "title": "Implement Operator Wake-Up SendMessage",
        "description": "Communicator → team-lead WORK_FOUND messages (F1.6)",
        "details": "SendMessage(type='message', recipient='team-lead', content='WORK_FOUND: [beads/git/tmux context]', summary='P0 work detected'). Wakes idle Operator in same session.",
        "testStrategy": "Idle Operator session → send WORK_FOUND → verify wakes and processes (AC-1.6)",
        "priority": "high",
        "dependencies": [
          30,
          31
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 42,
        "title": "Add APScheduler Cron Jobs Configuration",
        "description": "Morning briefing 7AM, EOD 6PM, weekly reflection (F1.4)",
        "details": "Create .claude/cron.json: {'morning_briefing': '7 0 * * *', 'eod_summary': '0 18 * * *', 'weekly_reflect': '0 8 * * 1'}. APScheduler loads from config, spawns isolated sessions.",
        "testStrategy": "Manual trigger each job type; Verify isolated session execution; Test job persistence across restarts (AC-1.4)",
        "priority": "medium",
        "dependencies": [
          30
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 43,
        "title": "Implement Morning Briefing Cron Job",
        "description": "7AM isolated session: overnight beads/PRs/pending work summary",
        "details": "Cron job spawns isolated session: 'Summarize: bd list --since=yesterday, gh pr list --updated=\"1d\", Hindsight active goals'. Output to Google Chat + Hindsight retain.",
        "testStrategy": "Manual 7AM trigger → verify summary content; Test Google Chat delivery (AC-1.4)",
        "priority": "medium",
        "dependencies": [
          42,
          36
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 44,
        "title": "Implement Stop Gate Communicator Checker",
        "description": "Block Operator exit if s3-communicator active (F1.9)",
        "details": "unified_stop_gate/communicator_checker.py: Check ~/.claude/teams/s3-live/config.json for active communicator → if running: exit 2 'Communicator active'; else: exit 0.",
        "testStrategy": "Stop gate with active communicator → verify BLOCK; Without → verify PASS (AC-1.10)",
        "priority": "high",
        "dependencies": [
          30
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 45,
        "title": "Implement Session Start Recall Hook",
        "description": "Post-compaction: recall active goals, completion promises (F1.7)",
        "details": "Enhance SessionStart hook: 1) Hindsight recall 'What was I working on before compaction?' 2) Restore active goals 3) Check pending completion promises by UUID 4) Within 30s.",
        "testStrategy": "Simulate compaction → restart → verify recall restores context in 30s (AC-1.8)",
        "priority": "medium",
        "dependencies": [
          26
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 46,
        "title": "Implement User Intermediary Pattern",
        "description": "Operator ASK_USER → Communicator → Google Chat → response relay (F1.8)",
        "details": "Operator: SendMessage('s3-communicator', 'ASK_USER: [2-4 options]') → idle. Communicator → Google Chat. User responds → Communicator → SendMessage('team-lead', 'USER_RESPONSE: [answer]').",
        "testStrategy": "Full E2E: Operator asks → Google Chat receives → user responds → Operator wakes with answer (AC-1.9)",
        "priority": "high",
        "dependencies": [
          30,
          33,
          36,
          40,
          41
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 47,
        "title": "Implement Post-Session Narrative Logging",
        "description": "Auto-generate GEO chain after each session (F3.2)",
        "details": "Post-session hook: Generate Goal→Experience→Outcome narrative → store in Hindsight experience network. Link beads IDs, session UUIDs. Searchable via recall().",
        "testStrategy": "Run test session → verify GEO chain in Hindsight; Test recall queries find narrative (AC-3.2)",
        "priority": "medium",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 48,
        "title": "Implement Auth Failure Recovery",
        "description": "API key rotation for auth failures (F4.2)",
        "details": "Auth classified failures → rotate API key profile (OpenClaw pattern). Update ~/.claude/api_keys.json → retry orchestrator. Log rotation success/failure.",
        "testStrategy": "Simulate API 401 → verify key rotation → successful retry (AC-4.2)",
        "priority": "medium",
        "dependencies": [
          29
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 49,
        "title": "Implement Resource Failure Recovery",
        "description": "Model downgrade + context reduction for OOM/rate limits (F4.2)",
        "details": "Resource failures → Opus→Sonnet→Haiku downgrade; truncate context to 50%; retry. Track downgrade success rates in Hindsight.",
        "testStrategy": "Simulate context overflow → verify downgrade → success (AC-4.3)",
        "priority": "medium",
        "dependencies": [
          29
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 50,
        "title": "Implement Daily Session Distillation Cron",
        "description": "End-of-day reflect(budget='mid') on session narratives (F3.3)",
        "details": "Cron job: Query today's GEO chains → reflect(budget='mid') → promote patterns to observation network → flag anti-patterns. Depends on F1.4 cron.",
        "testStrategy": "Manual trigger → verify synthesizes multiple narratives; Test pattern promotion (AC-3.3)",
        "priority": "medium",
        "dependencies": [
          42,
          47
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 51,
        "title": "Implement Session Transcript Indexing",
        "description": "Chunk transcripts (400t/80t overlap) for Hindsight search (F3.5)",
        "details": "Post-session: chunk main session transcripts → index in Hindsight. Enable queries: 'What did I do last Tuesday?'. Main sessions only (privacy).",
        "testStrategy": "Index test transcripts → recall 'yesterday' → verify relevant chunks returned (AC-3.5)",
        "priority": "medium",
        "dependencies": [
          47
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 52,
        "title": "Create Capability Self-Model Tracking",
        "description": "Track success rates/confidence per capability domain (F5.1)",
        "details": "Post-session: Update ~/.claude/capability_model.json: {backend_orch: {confidence: 0.85, success_rate: 92%}, ...}. Use in goal selection: prefer high-confidence domains.",
        "testStrategy": "Run sessions across domains → verify metrics update; Test goal selection bias (AC-5.1)",
        "priority": "medium",
        "dependencies": [
          47
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 53,
        "title": "Implement Command Queue Lanes",
        "description": "Separate heartbeat vs user command execution (F1.5, Phase 5)",
        "details": "Team-level queue management: heartbeat_lane (low priority), user_lane (high priority). If heartbeat running → queue completion, prioritize user commands.",
        "testStrategy": "Simultaneous heartbeat + user command → verify user priority (AC-1.5)",
        "priority": "low",
        "dependencies": [
          30,
          31
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 54,
        "title": "Implement Google Chat Command Reception",
        "description": "status/bd ready/start/approve commands via natural language (F2.5)",
        "details": "'What's the status?' → execute status check → reply same thread. Supported: status, bd ready, start [initiative], approve, reject.",
        "testStrategy": "Send natural language commands → verify execution + threaded reply (AC-2.6)",
        "priority": "medium",
        "dependencies": [
          40
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 55,
        "title": "Create IDENTITY.md Self-Model",
        "description": "System 3 self-description, disposition traits (F5.4)",
        "details": ".claude/IDENTITY.md: confidence: high, risk_tolerance: medium, comm_style: concise. Evolves via user feedback + outcomes. Used by reflect().",
        "testStrategy": "Load IDENTITY.md in session → verify influences responses (AC-5.4)",
        "priority": "low",
        "dependencies": [
          52
        ],
        "status": "pending",
        "subtasks": []
      }
    ],
    "metadata": {
      "created": "2026-02-15T01:51:38.443Z",
      "updated": "2026-02-15T01:51:38.443Z",
      "description": "Tasks for master context"
    }
  }
}