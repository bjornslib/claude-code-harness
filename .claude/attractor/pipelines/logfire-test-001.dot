digraph "LOGFIRE-TEST-001" {
    graph [
        label="Logfire E2E: PRD Improvement via SDK Chain"
        labelloc="t"
        fontsize=16
        rankdir="TB"
        prd_ref="LOGFIRE-TEST-001"
        promise_id=""
        target_dir="/Users/theb/Documents/Windsurf/claude-harness-setup"
    ];

    node [fontname="Helvetica" fontsize=11];
    edge [fontname="Helvetica" fontsize=9];

    // Entry
    start [
        shape=Mdiamond
        label="START"
        handler="start"
        status="validated"
        style=filled
        fillcolor=lightgreen
    ];

    // Single codergen node: improve an existing PRD
    impl_improve_prd [
        shape=box
        label="Improve PRD:\nAdd missing sections"
        handler="codergen"
        bead_id="LOGFIRE-TEST-IMPL"
        worker_type="backend-solutions-engineer"
        acceptance="Read .taskmaster/docs/PRD-CLEANUP-001.md. Add a 'Success Metrics' section at the end with 2-3 measurable KPIs. Add a 'Risks and Mitigations' section with 2-3 risks. Commit the changes."
        prd_ref="LOGFIRE-TEST-001"
        status="active"
    
        fillcolor="lightblue"
    
        style="filled"
    ];

    start -> impl_improve_prd [label="begin"];

    // Validation gate
    validate_prd_improvement [
        shape=hexagon
        label="PRD Improvement\nValidation"
        handler="wait.human"
        gate="technical"
        mode="technical"
        bead_id="AT-LOGFIRE-TEST"
        acceptance="PRD-CLEANUP-001.md contains a 'Success Metrics' section and a 'Risks and Mitigations' section"
        status="pending"
    ];

    impl_improve_prd -> validate_prd_improvement [label="impl_complete"];

    // Exit
    finalize [
        shape=Msquare
        label="FINALIZE"
        handler="exit"
        status="pending"
    ];

    validate_prd_improvement -> finalize [label="validated"];
}
