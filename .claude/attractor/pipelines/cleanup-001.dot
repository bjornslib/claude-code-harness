digraph "PRD-CLEANUP-001" {
    graph [
        label="Initiative: PRD-CLEANUP-001"
        labelloc="t"
        fontsize=16
        rankdir="TB"
        prd_ref="PRD-CLEANUP-001"
        promise_id=""
    ];

    node [fontname="Helvetica" fontsize=11];
    edge [fontname="Helvetica" fontsize=9];

    // ===== STAGE 1: PARSE =====

    start [
        shape=Mdiamond
        label="PARSE\nPRD-CLEANUP-001"
        handler="start"
        status="validated"
        style=filled
        fillcolor=lightgreen
    ];

    // ===== STAGE 2: VALIDATE =====

    validate_graph [
        shape=box
        label="Validate Graph\nStructure"
        handler="tool"
        command="attractor validate pipeline.dot"
        status="validated"
        style=filled
        fillcolor="lightgreen"
    ];

    start -> validate_graph [label="parse complete"];

    // ===== STAGE 3: INITIALIZE =====

    init_env [
        shape=box
        label="Initialize\nEnvironment"
        handler="tool"
        command="launchorchestrator prd-cleanup-001"
        status="validated"
        style=filled
        fillcolor="lightgreen"
    ];

    validate_graph -> init_env [label="graph valid"];

    // ===== STAGE 5: FINALIZE =====
    // Stage 4 EXECUTE: add task nodes with 'cli.py node <file> add ...'

    finalize [
        shape=Msquare
        label="FINALIZE\nTriple Gate\ncs-verify"
        handler="exit"
        promise_id=""
        status="validated"
        style=filled
        fillcolor="lightgreen"
    ];

    task_safe_deletes [
        shape="box"
        label="Task 1: Safe Deletes"
        handler="codergen"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        bead_id="CLEANUP-T1"
        worker_type="general-purpose"
        acceptance="All empty/placeholder/archive/cache/project-specific files deleted. .gitignore updated. pytest passes."
    ];

    task_safe_deletes_at [
        shape="hexagon"
        label="Validate: Task 1: Safe Deletes"
        handler="wait.human"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        gate="technical"
        mode="technical"
    ];

    task_safe_deletes -> task_safe_deletes_at;

    task_xref_analysis [
        shape="box"
        label="Task 2: Cross-Ref Analysis"
        handler="codergen"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        bead_id="CLEANUP-T2"
        worker_type="general-purpose"
        acceptance="Each orphaned hook/util/command disposition recorded. Zero orphans remain. pytest passes."
    ];

    task_xref_analysis_at [
        shape="hexagon"
        label="Validate: Task 2: Cross-Ref Analysis"
        handler="wait.human"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        gate="technical"
        mode="technical"
    ];

    task_xref_analysis -> task_xref_analysis_at;

    task_state_docs [
        shape="box"
        label="Task 3: State + Docs"
        handler="codergen"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        bead_id="CLEANUP-T3"
        worker_type="general-purpose"
        acceptance="State dirs cleaned per retention. Docs reviewed and resolved. Only deletions in git diff. pytest passes."
    ];

    task_state_docs_at [
        shape="hexagon"
        label="Validate: Task 3: State + Docs"
        handler="wait.human"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        gate="technical"
        mode="technical"
    ];

    task_state_docs -> task_state_docs_at;

    init_env -> task_safe_deletes [
        label="begin"
    ];

    task_safe_deletes_at -> task_xref_analysis [
        label="pass"
        condition="pass"
    ];

    task_xref_analysis_at -> task_state_docs [
        label="pass"
        condition="pass"
    ];

    task_state_docs_at -> finalize [
        label="pass"
        condition="pass"
    ];
}
