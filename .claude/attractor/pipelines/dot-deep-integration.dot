digraph ".taskmaster/docs/PRD-S3-DOT-LIFECYCLE-002.md" {
    graph [
        label="Initiative: .taskmaster/docs/PRD-S3-DOT-LIFECYCLE-002.md"
        labelloc="t"
        fontsize=16
        rankdir="TB"
        prd_ref=".taskmaster/docs/PRD-S3-DOT-LIFECYCLE-002.md"
        promise_id=""
    ];

    node [fontname="Helvetica" fontsize=11];
    edge [fontname="Helvetica" fontsize=9];

    // ===== STAGE 1: PARSE =====

    start [
        shape=Mdiamond
        label="PARSE\n.taskmaster/docs/PRD-S3-DOT-LIFECYCLE-002.md"
        handler="start"
        status="validated"
        style=filled
        fillcolor=lightgreen
    ];

    // ===== STAGE 2: VALIDATE =====

    validate_graph [
        shape=box
        label="Validate Graph\nStructure"
        handler="tool"
        command="attractor validate pipeline.dot"
        status="validated"
        style=filled
        fillcolor="lightgreen"
    ];

    start -> validate_graph [label="parse complete"];

    // ===== STAGE 3: INITIALIZE =====

    init_env [
        shape=box
        label="Initialize\nEnvironment"
        handler="tool"
        command="launchorchestrator taskmaster-docs-prd-s3-dot-lifecycle-002-md"
        status="validated"
        style=filled
        fillcolor="lightgreen"
    ];

    validate_graph -> init_env [label="graph valid"];

    // ===== STAGE 5: FINALIZE =====
    // Stage 4 EXECUTE: add task nodes with 'cli.py node <file> add ...'

    finalize [
        shape=Msquare
        label="FINALIZE\nTriple Gate\ncs-verify"
        handler="exit"
        promise_id=""
        status="validated"
        style=filled
        fillcolor="lightgreen"
    ];

    init_env -> finalize [label="ready"];


    impl_m1_guardian_skill [
        shape="box"
        label="M1: Guardian SKILL.md — Phase 1.5 + DOT Phase 4"
        handler="codergen"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        worker_type="general-purpose"
        acceptance="Phase 1.5 pipeline generation added; Phase 4 rewired DOT-driven"
    
        bead_id="claude-harness-setup-w9fb"
    ];

    impl_m1_guardian_skill_at [
        shape="hexagon"
        label="Validate: M1: Guardian SKILL.md — Phase 1.5 + DOT Phase 4"
        handler="wait.human"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        gate="technical"
        mode="technical"
    ];

    impl_m1_guardian_skill -> impl_m1_guardian_skill_at;

    impl_m2_guardian_workflow [
        shape="box"
        label="M2: Guardian Workflow — Pipeline Gen + Beads"
        handler="codergen"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        worker_type="general-purpose"
        acceptance="Pipeline gen workflow with beads creation and bead_id mapping"
    
        bead_id="claude-harness-setup-hxqq"
    ];

    impl_m2_guardian_workflow_at [
        shape="hexagon"
        label="Validate: M2: Guardian Workflow — Pipeline Gen + Beads"
        handler="wait.human"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        gate="technical"
        mode="technical"
    ];

    impl_m2_guardian_workflow -> impl_m2_guardian_workflow_at;

    impl_m3_orch_skill [
        shape="box"
        label="M3: Orchestrator Skill — Pipeline Mandatory"
        handler="codergen"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        worker_type="general-purpose"
        acceptance="PREFLIGHT mandatory; node-driven spawn; beads sync"
    
        bead_id="claude-harness-setup-cm4f"
    ];

    impl_m3_orch_skill_at [
        shape="hexagon"
        label="Validate: M3: Orchestrator Skill — Pipeline Mandatory"
        handler="wait.human"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        gate="technical"
        mode="technical"
    ];

    impl_m3_orch_skill -> impl_m3_orch_skill_at;

    impl_m4_output_style [
        shape="box"
        label="M4: Output Style — Slim DOT ~40 lines"
        handler="codergen"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        worker_type="general-purpose"
        acceptance="264 lines to ~40; MANDATORY flag; reference pointer"
    
        bead_id="claude-harness-setup-m94n"
    ];

    impl_m4_output_style_at [
        shape="hexagon"
        label="Validate: M4: Output Style — Slim DOT ~40 lines"
        handler="wait.human"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        gate="technical"
        mode="technical"
    ];

    impl_m4_output_style -> impl_m4_output_style_at;

    impl_m5_pipeline_ref [
        shape="box"
        label="M5: Pipeline Workflows + Beads-DOT Sync (NEW)"
        handler="codergen"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        worker_type="general-purpose"
        acceptance="Full pipeline reference with beads-DOT sync protocol"
    
        bead_id="claude-harness-setup-scgq"
    ];

    impl_m5_pipeline_ref_at [
        shape="hexagon"
        label="Validate: M5: Pipeline Workflows + Beads-DOT Sync (NEW)"
        handler="wait.human"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        gate="technical"
        mode="technical"
    ];

    impl_m5_pipeline_ref -> impl_m5_pipeline_ref_at;

    impl_m6_validation_scoring [
        shape="box"
        label="M6: Validation Scoring — DOT Node-Driven"
        handler="codergen"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        worker_type="general-purpose"
        acceptance="Hexagon scoring with gherkin_ref and transition semantics"
    
        bead_id="claude-harness-setup-xsn6"
    ];

    impl_m6_validation_scoring_at [
        shape="hexagon"
        label="Validate: M6: Validation Scoring — DOT Node-Driven"
        handler="wait.human"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        gate="technical"
        mode="technical"
    ];

    impl_m6_validation_scoring -> impl_m6_validation_scoring_at;

    impl_c1_gherkin_bridge [
        shape="box"
        label="C1: Gherkin-DOT Bridge (NEW)"
        handler="codergen"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        worker_type="general-purpose"
        acceptance="Mapping algorithm, hexagon schema, scoring flow, examples"
    
        bead_id="claude-harness-setup-0e6v"
    ];

    impl_c1_gherkin_bridge_at [
        shape="hexagon"
        label="Validate: C1: Gherkin-DOT Bridge (NEW)"
        handler="wait.human"
        status="validated"
        style="filled"
        fillcolor="lightgreen"
        gate="technical"
        mode="technical"
    ];

    impl_c1_gherkin_bridge -> impl_c1_gherkin_bridge_at;

    init_env -> impl_m1_guardian_skill [
        label="env ready"
    ];

    init_env -> impl_m2_guardian_workflow [
        label="env ready"
    ];

    init_env -> impl_m3_orch_skill [
        label="env ready"
    ];

    init_env -> impl_m4_output_style [
        label="env ready"
    ];

    init_env -> impl_m5_pipeline_ref [
        label="env ready"
    ];

    init_env -> impl_m6_validation_scoring [
        label="env ready"
    ];

    init_env -> impl_c1_gherkin_bridge [
        label="env ready"
    ];

    impl_m1_guardian_skill_at -> finalize [
        label="validated"
    ];

    impl_m2_guardian_workflow_at -> finalize [
        label="validated"
    ];

    impl_m3_orch_skill_at -> finalize [
        label="validated"
    ];

    impl_m4_output_style_at -> finalize [
        label="validated"
    ];

    impl_m5_pipeline_ref_at -> finalize [
        label="validated"
    ];

    impl_m6_validation_scoring_at -> finalize [
        label="validated"
    ];

    impl_c1_gherkin_bridge_at -> finalize [
        label="validated"
    ];
}
